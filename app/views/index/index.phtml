<?php $items = $this->entryPaginator->items (); ?>
<?php if (!empty ($items)) { ?>
<div id="top">
	<?php if (!login_is_conf ($this->conf) || is_logged ()) { ?>
	<a class="read_all" href="<?php echo Url::display (array ('c' => 'entry', 'a' => 'read', 'params' => array ('is_read' => 1))); ?>">Tout marquer comme lu</a><?php } ?><!--
	<?php if ($this->mode == 'not_read') { ?>
	--><a class="print_all" href="<?php echo Url::display (array ('a' => 'changeMode', 'params' => array ('mode' => 'all'))); ?>">Tout afficher</a>
	<?php } else { ?>
	--><a class="print_non_read" href="<?php echo Url::display (array ('a' => 'changeMode', 'params' => array ('mode' => 'not_read'))); ?>">Afficher les non lus</a>
	<?php } ?>
</div>

<div id="stream">
	<?php $this->entryPaginator->render ('pagination.phtml', 'page'); ?>
	
	<?php foreach ($items as $item) { ?>
	<div class="post flux<?php echo !$item->isRead () ? ' not_read' : ''; ?><?php echo $item->isFavorite () ? ' favorite' : ''; ?>" id="flux_<?php echo $item->id (); ?>">
		<h1 class="title"><a target="_blank" href="<?php echo $item->link (); ?>"> <?php echo $item->title (); ?></a></h1>
		
		<div class="before">
			<?php $author = $item->author (); ?>
			<?php $feed = $item->feed (true); ?>
			Le <?php echo $item->date (); ?>
			<?php echo $author != '' ? ' par ' . $author : ''; ?>
			sur <a target="_blank" href="<?php echo $feed->website (); ?>"><?php echo $feed->name (); ?> <img src="http://www.google.com/s2/favicons?domain=<?php echo get_domain ($feed->website ()); ?>" alt="" /></a>,
		</div>
		
		<div class="content"><?php echo $item->content (); ?></div>
		
		<div class="after">
			<?php if (!login_is_conf ($this->conf) || is_logged ()) { ?>
			<?php if (!$item->isRead ()) { ?>
			<a class="read" href="<?php echo Url::display (array ('c' => 'entry', 'a' => 'read', 'params' => array ('id' => $item->id (), 'is_read' => 1))); ?>">J'ai fini de lire l'article</a>
			<?php } else { ?>
			<a class="read" href="<?php echo Url::display (array ('c' => 'entry', 'a' => 'read', 'params' => array ('id' => $item->id (), 'is_read' => 0))); ?>">Marquer comme non lu</a>
			<?php } ?>
			-
			<?php if (!$item->isFavorite ()) { ?>
			<a class="bookmark" href="<?php echo Url::display (array ('c' => 'entry', 'a' => 'bookmark', 'params' => array ('id' => $item->id (), 'is_favorite' => 1))); ?>">Ajouter l'article à mes favoris</a>
			<?php } else { ?>
			<a class="bookmark" href="<?php echo Url::display (array ('c' => 'entry', 'a' => 'bookmark', 'params' => array ('id' => $item->id (), 'is_favorite' => 0))); ?>">Retirer l'article de mes favoris</a>
			<?php } ?>
			<?php } ?>
		</div>
	</div>
	<?php } ?>
	
	<?php $this->entryPaginator->render ('pagination.phtml', 'page'); ?>
</div>
<?php } else { ?>
<div class="table">
	<div class="nothing">
		<p>
			Il n'y a aucun flux à afficher.
		<?php if (Session::param ('mode', 'all') == 'not_read') { ?>
		<a class="print_all" href="<?php echo Url::display (array ('a' => 'changeMode', 'params' => array ('mode' => 'all'))); ?>">Afficher tous les articles ?</a>
		<?php }	?>
		</p>
	</div>
</div>
<?php } ?>
