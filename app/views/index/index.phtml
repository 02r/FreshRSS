<?php $this->partial ('aside_flux'); ?>

<?php $this->partial ('nav_menu'); ?>

<?php
if (isset ($this->entryPaginator)) {
	$items = $this->entryPaginator->items (true);
?>
<div id="stream">
	<?php
		$display_today = true;
		$display_yesterday = true;
		$display_others = true;
	?>
	<?php foreach ($items as $item) { ?>

	<?php if ($display_today && $item->isDay (Days::TODAY)) { ?>
	<div class="day">Aujourd'hui - <?php echo timestamptodate (time (), false); ?></div>
	<?php $display_today = false; } ?>
	<?php if ($display_yesterday && $item->isDay (Days::YESTERDAY)) { ?>
	<div class="day">Hier - <?php echo timestamptodate (time () - 86400, false); ?></div>
	<?php $display_yesterday = false; } ?>
	<?php if ($display_others && $item->isDay (Days::BEFORE_YESTERDAY)) { ?>
	<div class="day">À partir d'avant-hier</div>
	<?php $display_others = false; } ?>

	<div class="flux<?php echo !$item->isRead () ? ' not_read' : ''; ?><?php echo $item->isFavorite () ? ' favorite' : ''; ?>" id="flux_<?php echo $item->id (); ?>">
		<ul class="flux_header">
			<?php if (!login_is_conf ($this->conf) || is_logged ()) { ?>
			<li class="item manage">
				<?php if (!$item->isRead ()) { ?>
				<a class="read" href="<?php echo _url ('entry', 'read', 'id', $item->id (), 'is_read', 1); ?>">&nbsp;</a>
				<?php } else { ?>
				<a class="read" href="<?php echo _url ('entry', 'read', 'id', $item->id (), 'is_read', 0); ?>">&nbsp;</a>
				<?php } ?>

				<?php if (!$item->isFavorite ()) { ?>
				<a class="bookmark" href="<?php echo _url ('entry', 'bookmark', 'id', $item->id (), 'is_favorite', 1); ?>">&nbsp;</a>
				<?php } else { ?>
				<a class="bookmark" href="<?php echo _url ('entry', 'bookmark', 'id', $item->id (), 'is_favorite', 0); ?>">&nbsp;</a>
				<?php } ?>

				<a class="note" href="<?php echo _url ('entry', 'note', 'id', $item->id ()); ?>">
					<?php if ($item->notes () != '') { ?>
					<i class="icon i_note"></i>
					<?php } else { ?>
					<i class="icon i_note_empty"></i>
					<?php } ?>
				</a>
			</li>
			<?php } ?>
			<?php $feed = $item->feed (true); ?>
			<li class="item website"><a target="_blank" href="<?php echo $feed->website (); ?>"><img class="favicon" src="http://g.etfv.co/<?php echo $feed->website (); ?>" alt="favicon <?php echo $feed->name (); ?>" /> <span><?php echo $feed->name (); ?></span></a></li>
			<li class="item title"><h1><?php echo $item->title (); ?></h1></li>
			<li class="item date">le <?php echo $item->date (); ?></li>
			<li class="item link"><a target="_blank" href="<?php echo $item->link (); ?>">&nbsp;</a></li>
		</ul>
		
		<div class="content">
			<?php $author = $item->author (); ?>
			<?php echo $author != '' ? '<div class="author">Par <em>' . $author . '</em></div>' : ''; ?>
			<?php echo $item->content (); ?>
		</div>
	</div>
	<?php } ?>
	
	<?php $this->entryPaginator->render ('pagination.phtml', 'page'); ?>
</div>
<?php } else { ?>
<div class="alert">
	<span class="alert-head">Il n'y a aucun flux à afficher.</span>
	<?php if (Session::param ('mode', 'all') == 'not_read') { ?>
	<a class="print_all" href="<?php echo _url ('index', 'changeMode', 'mode', 'all'); ?>">Afficher tous les articles ?</a>
	<?php }	?>
</div>
<?php } ?>
