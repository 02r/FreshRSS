<?php $this->partial('aside_feed'); ?>

<div>
	<form id="configure-categorize" method="post" style="display: none;"></form>

	<div class="box">
		<div class="box-title"><label for="new-category"><?php echo _t('add_category'); ?></label></div>

		<div class="box-content">
			<form action="<?php echo _url('category', 'create'); ?>" method="post">
				<input type="text" id="new-category" name="new-category" placeholder="<?php echo _t('new_category'); ?>" />
				<input type="submit" value="<?php echo _t('submit'); ?>" />
			</form>
		</div>
	</div>

	<?php
		foreach ($this->categories as $cat) {
			$feeds = $cat->feeds();
	?>
	<div class="box">
		<div class="box-title stick">
			<input type="text" value="<?php echo $cat->name(); ?>" />
			<div class="dropdown">
				<div id="dropdown-cat-<?php echo $cat->id(); ?>" class="dropdown-target"></div>

				<a class="dropdown-toggle btn" href="#dropdown-cat-<?php echo $cat->id(); ?>"><?php echo _i('down'); ?></a>
				<ul class="dropdown-menu">
					<li class="dropdown-close"><a href="#close">❌</a></li>

					<li class="item">
						<button class="as-link confirm"
						        data-str-confirm="<?php echo _t('confirm_action_feed_cat'); ?>"
						        type="submit"
						        form="configure-categorize"
						        formaction="<?php echo _url('feed', 'delete', 'id', $cat->id(), 'type', 'category'); ?>"><?php echo _t('ask_empty'); ?></button>
					</li>
					<li class="item"><a href=""><?php echo _t('delete'); ?></a></li>
				</ul>
			</div>
		</div>

		<ul class="box-content">
			<?php if (!empty($feeds)) { ?>
			<?php
					foreach ($feeds as $feed) {
						$error = $feed->inError() ? ' error' : '';
						$empty = $feed->nbEntries() == 0 ? ' empty' : '';
			?>
			<li id="f_<?php echo $feed->id(); ?>" class="item<?php echo $error, $empty; ?>">
				<a href="<?php echo _url('configure', 'feed', 'id', $feed->id()); ?>"><?php echo _i('configure'); ?></a>
				<img class="favicon" src="<?php echo $feed->favicon(); ?>" alt="✇" /> <?php echo $feed->name(); ?>
			</li>
			<?php
					}
				} else {
			?>
			<li>Empty</li>
			<?php } ?>
		</ul>
	</div>
	<?php } ?>
</div>
