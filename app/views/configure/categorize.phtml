<?php $this->partial('aside_feed'); ?>

<div class="post">
	<a href="<?php echo _url('index', 'index'); ?>"><?php echo _t('back_to_rss_feeds'); ?></a>

	<h2><?php echo _t('categories_management'); ?></h2>

	<p class="alert alert-warn">
		<?php echo _t('feeds_moved_category_deleted', $this->default_category->name()); ?>
	</p>

	<div class="box">
		<div class="box-title"><label for="new-category"><?php echo _t('add_category'); ?></label></div>

		<ul class="box-content box-content-centered">
			<form action="<?php echo _url('category', 'create'); ?>" method="post">
				<li class="item"><input type="text" id="new-category" name="new-category" placeholder="<?php echo _t('new_category'); ?>" /></li>
				<li class="item"><button class="btn btn-important" type="submit"><?php echo _t('submit'); ?></button></li>
			</form>
		</ul>
	</div>

	<form id="controller-category" method="post" style="display: none;"></form>

	<?php
		foreach ($this->categories as $cat) {
			$feeds = $cat->feeds();
	?>
	<div class="box">
		<div class="box-title">
			<form action="<?php echo _url('category', 'update', 'id', $cat->id()); ?>" method="post">
				<input type="text" name="name" value="<?php echo $cat->name(); ?>" />

				<div class="dropdown">
					<div id="dropdown-cat-<?php echo $cat->id(); ?>" class="dropdown-target"></div>

					<a class="dropdown-toggle btn" href="#dropdown-cat-<?php echo $cat->id(); ?>"><?php echo _i('down'); ?></a>
					<ul class="dropdown-menu">
						<li class="dropdown-close"><a href="#close">❌</a></li>

						<li class="item"><a href="<?php echo _url('index', 'index', 'get', 'c_' . $cat->id()); ?>"><?php echo _t('filter'); ?></a></li>

						<li class="separator"></li>

						<?php if (!empty($feeds)) { ?>
						<li class="item">
							<button class="as-link confirm"
							        data-str-confirm="<?php echo _t('confirm_action_feed_cat'); ?>"
							        type="submit"
							        form="controller-category"
							        formaction="<?php echo _url('category', 'empty', 'id', $cat->id()); ?>">
							        <?php echo _t('ask_empty'); ?></button>
						</li>
						<?php } ?>
						<li class="item">
							<button class="as-link confirm"
							        data-str-confirm="<?php echo _t('confirm_action_feed_cat'); ?>"
							        type="submit"
							        form="controller-category"
							        formaction="<?php echo _url('category', 'delete', 'id', $cat->id()); ?>">
							        <?php echo _t('delete'); ?></button>
						</li>
					</ul>
				</div>
			</form>
		</div>

		<ul class="box-content">
			<?php if (!empty($feeds)) { ?>
			<?php
					foreach ($feeds as $feed) {
						$error = $feed->inError() ? ' error' : '';
						$empty = $feed->nbEntries() == 0 ? ' empty' : '';
			?>
			<li class="item<?php echo $error, $empty; ?>">
				<a class="configure open-slider" href="<?php echo _url('configure', 'feed', 'id', $feed->id()); ?>"><?php echo _i('configure'); ?></a>
				<img class="favicon" src="<?php echo $feed->favicon(); ?>" alt="✇" /> <?php echo $feed->name(); ?>
			</li>
			<?php 	}
				} else {
			?>
			<li class="item"><?php echo _t('category_empty'); ?></li>
			<?php } ?>
		</ul>
	</div>
	<?php } ?>
</div>

<div id="slider">
</div>
